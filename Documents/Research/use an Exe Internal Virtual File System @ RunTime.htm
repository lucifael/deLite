<HTML><HEAD><TITLE>SwissDelphiCenter.ch : ...use an Exe Internal Virtual File System @ RunTime?</TITLE></HEAD><META NAME="Title" CONTENT="SwissDelphiCenter.ch">
<META NAME="Author" CONTENT="Simon Grossenbacher"
<META NAME="Publisher" CONTENT="SwissDelphiCenter.ch">
<META NAME="Revisit" CONTENT="After 30 days">
<META NAME="Keywords" 
CONTENT="delphi,borland,programm,programming,schweiz,forum,forums,newsletter,download,delphi,kylix,linux,windows,winapi,libc, api">
<META NAME="Description" CONTENT="All about Borland Delphi. Programming tips, downloads, forums, news, topsites, newsletter">
<META NAME="Abstract" CONTENT="All about Borland Delphi.">
<META NAME="Robots" CONTENT="INDEX,FOLLOW">
<META NAME="expires" CONTENT="0">
<link rel="SHORTCUT ICON" href="http://www.swissdelphicenter.ch/favicon.ico">

<link rel="STYLESHEET" href="../swissdelphicenter.css" type="text/css">
</head>
<body bgcolor="#FFFFFF">
<table width="100%" border="0">
  <tr>
    <td width="33%"><i><a href="index.php"><img src="../pics/sdclogo.png" border="0" width="300" height="40"></a></i></td>
    <td width="67%">
<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000' codebase='http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=4,0,0,0' width='468' height='60'><param name='movie' value='http://www.swissdelphicenter.com/ads/banners/fbhowdoi.swf?alink1=http://www.swissdelphicenter.ch/ads/adclick.php%3Fbannerid=99%26zoneid=7%26source=%26dest=http%3A%2F%2Fwww.atozedsoftware.com&atar1=_blank'><param name='quality' value='high'><embed src='http://www.swissdelphicenter.com/ads/banners/fbhowdoi.swf?alink1=http://www.swissdelphicenter.ch/ads/adclick.php%3Fbannerid=99%26zoneid=7%26source=%26dest=http%3A%2F%2Fwww.atozedsoftware.com&atar1=_blank' quality=high width='468' height='60' type='application/x-shockwave-flash' pluginspace='http://www.macromedia.com/go/getflashplayer'></embed></object><div id="beacon_99" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src='http://www.swissdelphicenter.ch/ads/adlog.php?bannerid=99&amp;clientid=115&amp;zoneid=7&amp;source=&amp;block=0&amp;capping=0&amp;cb=9daba3ff7490d50867575a1d4637046a' width='0' height='0' alt='' style='width: 0px; height: 0px;'></div><br>

&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<a href="werbung.php">Advertising on SwissDelphiCenter</a>

</td>
  </tr>
</table>
<br>
&nbsp;<a href="whatsnew.php">whats new</a>&nbsp;&brvbar;&nbsp;
<a href="tipsindex.php">programming tips</a>&nbsp;&brvbar;&nbsp;
<a href="indyarticles.php">indy articles</a>&nbsp;&brvbar;&nbsp;
<a href="iwarticles.php">intraweb articles</a>&nbsp;&brvbar;&nbsp;
<a href="infoindex.php">informations</a>&nbsp;&brvbar;&nbsp;
<a href="linksindex.php">links</a>&nbsp;&brvbar;&nbsp;
<a href="interviews.php">interviews</a>&nbsp;&brvbar;&nbsp;
<a href="sonstigesindex.php">misc</a>&nbsp;&brvbar;&nbsp;
<a href="forum/index.php">forum</a>
<br>
&nbsp;<a href="devnews.php">developer news</a>&nbsp;&brvbar;&nbsp;
<a href="kylix.php">kylix</a>&nbsp;&brvbar;&nbsp;
<a href="tutorials.php">tutorials</a>&nbsp;&brvbar;&nbsp;
<a href="shop.php">online shop</a>&nbsp;&brvbar;&nbsp;
<a href="photos/index.php">photos</a>&nbsp;&brvbar;&nbsp;
<a href="addwin.php">Add&Win Game</a>
<br><br>
<table width="100%" border="0" cellpadding="4" cellspacing="0">
  <tr>
    <td>
    </td>
  </tr>
  <tr> 
    <td>
      <table width="100%" border="0" cellpadding="0" cellspacing="0">
        <tr> 
          <td width="21%" align="left" valign="top"> 
            <table border="0" bgcolor="#0099FF" cellpadding="2" cellspacing="0" width="100%">
              <tr align="left" valign="top"> 
                <td> 
                  <table width="100%" border="0" cellpadding="10" cellspacing="0">
                    <tr bgcolor="#99CCFF"> 
                      <td>
 
<p><b>Tips (1553)</b></p>

<a href="datenbanken.php">Database (90)</a><br><a href="dateien.php">Files (139)</a><br><a href="oberflaeche.php">Forms (112)</a><br><a href="grafik.php">Graphic (116)</a><br><a href="ide.php">IDE (21)</a><br><a href="indy.php">Indy (5)</a><br><a href="internet.php">Internet / LAN (130)</a><br><a href="intraweb.php">IntraWeb (0)</a><br><a href="kylixtips.php">Kylix (10)</a><br><a href="math.php">Math (77)</a><br><a href="sonstiges.php">Misc (126)</a><br><a href="multimedia.php">Multimedia (46)</a><br><a href="objekte.php">Objects/<br>ActiveX (51)</a><br><a href="opentools.php">OpenTools API (3)</a><br><a href="printing.php">Printing (34)</a><br><a href="strings.php">Strings (83)</a><br><a href="system.php">System (267)</a><br><a href="vcl.php">VCL (243)</a><br>


  <br>
  <a href="tiptop15.php">Top15</a><br><br>
  <a href="tipsbycomp.php">Tips sort by<br>component</a><br><br>
  <a href="tipsuchen.php">Search Tip</a><br><br>

  <a href="addtip.php">Add new Tip</a><br><br>
  <a href="addwin.php"><b>Add&Win Game</b></a>

</td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
            <br>
                    <table border="0" bgcolor="#0099FF" cellpadding="2" cellspacing="0" width="100%">
          <tr align="left" valign="top">
            <td height="3">
              <table width="100%" border="0" cellpadding="10" cellspacing="0" height="100%">
                <tr bgcolor="#FFFFFF" align="left" valign="top"> 
                  <td bgcolor="#99CCFF"><b>BorCon 2003 pictures</b></td>
                </tr>
                <tr bgcolor="#FFFFFF" align="left" valign="top">
                  
          <td>The Borland Conference 2003 has finished. We have taken some impressions for you in the <b><a 
href="http://www.swissdelphicenter.ch/en/photos/index.php">photo gallery</a></b></td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
            <br>            
            <table border="0" bgcolor="#0099FF" cellpadding="2" cellspacing="0" width="100%">
              <tr align="left" valign="top"> 
                <td> 
                  <table width="100%" border="0" cellpadding="10" cellspacing="0">
                    <tr bgcolor="#99CCFF" align="left" valign="top"> 
                      <td>
                        <center>
<span class="useronline">118 Visitors Online</span>                        </center>
                        </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
            <br><br>
            <center>
            <a href="http://www.borland.com" target="_blank"><img src="../pics/btp.gif" alt="SwissDelphiCenter is a Borland Technology Partner" border="0"></a>
            </center>
          </td>
          <td width="1%" align="left" valign="top">&nbsp;</td>
          <td align="left" valign="top" width="78%"> 
            <table width="100%" border="0" cellpadding="2" cellspacing="0" height="100%" bgcolor="#0099FF">
              <tr> 
                <td> 
                  <table width="100%" border="0" cellpadding="5" height="100%" bgcolor="#FFFFFF" cellspacing="0">
                    <tr align="left" valign="top"> 
                      <td> 

<table width="100%" border="0">
  <tr> 
    <td>
      <span class="titel">...use an Exe Internal Virtual File System @ RunTime?</span>
    </td>
  </tr>
  <tr> 
    <td>Autor: 
      <a href="sendmail.php?id=2427">Cybergen</a>    </td>
  </tr>
  <tr><td><a href="showcomment.php?id=2427">1 Comment(s) to this tip</a> [<a href="newcomment.php?id=2427">Write new comment</a>]</td></tr><tr><td>[ <a href="printcode.php?id=2427" target="_blank">Print tip</a> 
]</td><td>&nbsp;</td><td>&nbsp;</td></tr></table>
<br>
<table border="0" width="529">
  <tr> 
    <td width="149"><b>Tip Rating (7):</b></td>
    <td width="370">&nbsp;</td>
  </tr>
  <tr>
    <td>
<img src='../pics/progressbar-grau.gif'>&nbsp;<img src='../pics/progressbar-grau.gif'>&nbsp;<img src='../pics/progressbar-grau.gif'>&nbsp;<img src='../pics/progressbar-grau.gif'>&nbsp;<img src='../pics/progressbar-blau.gif'>&nbsp;</td>
  </tr>
</table>

<p><br>
</p>
<p>
<span class="sourcecode">
<font  size=2 face="Courier New" color="#000080"><i>{*********************************************************************<br />
&nbsp;This&nbsp;Sourcecode&nbsp;is&nbsp;Freeware&nbsp;i.e&nbsp;Credit-Ware:<br />
&nbsp;you&nbsp;should&nbsp;say&nbsp;e.g.&nbsp;&quot;Thanks&nbsp;to&nbsp;Cybergen&quot;<br />
&nbsp;if&nbsp;you&nbsp;use&nbsp;it&nbsp;in&nbsp;your&nbsp;software.<br />
&nbsp;At&nbsp;least,&nbsp;it&nbsp;would&nbsp;be&nbsp;&nbsp;^^&nbsp;nice.<br />
<br />
&nbsp;Cybergen&nbsp;&lt;nope2k@web.de&gt;<br />
*********************************************************************}<br />
<br />
{<br />
Reference:<br />
<br />
&nbsp;bool&nbsp;:&nbsp;csi_fat_available<br />
&nbsp;bool&nbsp;:&nbsp;csi_fat_get_file_list(files:tstringlist)<br />
&nbsp;cardinal&nbsp;:&nbsp;cis_load_file(fn:string;p:pointer)<br />
&nbsp;bool&nbsp;:&nbsp;cis_save_file(fn:string)<br />
&nbsp;bool&nbsp;:&nbsp;cis_delete_file(fn:string)<br />
&nbsp;bool&nbsp;:&nbsp;cis_file_exists(fn:string)<br />
<br />
CIS-FAT&nbsp;-&nbsp;Code:&nbsp;[Cybergen&nbsp;Internal&nbsp;Small&nbsp;-&nbsp;File&nbsp;Allocation&nbsp;Table]<br />
}<br />
<br />
(*&nbsp;CSI-FAT&nbsp;-&nbsp;START&nbsp;*)<br />
<br />
</i></font><b>function&nbsp;</b>RunProg(Cmd,&nbsp;WorkDir:&nbsp;<b>string</b>):&nbsp;<b>string</b>;<br />
<b>var<br />
&nbsp;&nbsp;</b>tsi:&nbsp;TStartupInfo;<br />
&nbsp;&nbsp;tpi:&nbsp;TProcessInformation;<br />
&nbsp;&nbsp;nRead:&nbsp;DWORD;<br />
&nbsp;&nbsp;aBuf:&nbsp;<b>array</b>[0..101]&nbsp;<b>of&nbsp;</b>Char;<br />
&nbsp;&nbsp;sa:&nbsp;TSecurityAttributes;<br />
&nbsp;&nbsp;hOutputReadTmp,&nbsp;hOutputRead,&nbsp;hOutputWrite,&nbsp;hInputWriteTmp,&nbsp;hInputRead,<br />
&nbsp;&nbsp;hInputWrite,&nbsp;hErrorWrite:&nbsp;THandle;<br />
&nbsp;&nbsp;FOutput:&nbsp;<b>string</b>;<br />
<b>begin<br />
&nbsp;&nbsp;</b>FOutput&nbsp;:=&nbsp;'';<br />
<br />
&nbsp;&nbsp;sa.nLength&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=&nbsp;SizeOf(TSecurityAttributes);<br />
&nbsp;&nbsp;sa.lpSecurityDescriptor&nbsp;:=&nbsp;<b>nil</b>;<br />
&nbsp;&nbsp;sa.bInheritHandle&nbsp;:=&nbsp;True;<br />
<br />
&nbsp;&nbsp;CreatePipe(hOutputReadTmp,&nbsp;hOutputWrite,&nbsp;@sa,&nbsp;0);<br />
&nbsp;&nbsp;DuplicateHandle(GetCurrentProcess(),&nbsp;hOutputWrite,&nbsp;GetCurrentProcess(),<br />
&nbsp;&nbsp;&nbsp;&nbsp;@hErrorWrite,&nbsp;0,&nbsp;True,&nbsp;DUPLICATE_SAME_ACCESS);<br />
&nbsp;&nbsp;CreatePipe(hInputRead,&nbsp;hInputWriteTmp,&nbsp;@sa,&nbsp;0);<br />
<br />
&nbsp;&nbsp;<font color="#000080"><i>//&nbsp;Create&nbsp;new&nbsp;output&nbsp;read&nbsp;handle&nbsp;and&nbsp;the&nbsp;input&nbsp;write&nbsp;handle.&nbsp;Set<br />
&nbsp;&nbsp;//&nbsp;the&nbsp;inheritance&nbsp;properties&nbsp;to&nbsp;FALSE.&nbsp;Otherwise,&nbsp;the&nbsp;child&nbsp;inherits<br />
&nbsp;&nbsp;//&nbsp;the&nbsp;these&nbsp;handles;&nbsp;resulting&nbsp;in&nbsp;non-closeable&nbsp;handles&nbsp;to&nbsp;the&nbsp;pipes<br />
&nbsp;&nbsp;//&nbsp;being&nbsp;created.<br />
&nbsp;&nbsp;</i></font>DuplicateHandle(GetCurrentProcess(),&nbsp;hOutputReadTmp,&nbsp;GetCurrentProcess(),<br />
&nbsp;&nbsp;&nbsp;&nbsp;@hOutputRead,&nbsp;0,&nbsp;False,&nbsp;DUPLICATE_SAME_ACCESS);<br />
&nbsp;&nbsp;DuplicateHandle(GetCurrentProcess(),&nbsp;hInputWriteTmp,&nbsp;GetCurrentProcess(),<br />
&nbsp;&nbsp;&nbsp;&nbsp;@hInputWrite,&nbsp;0,&nbsp;False,&nbsp;DUPLICATE_SAME_ACCESS);<br />
&nbsp;&nbsp;CloseHandle(hOutputReadTmp);<br />
&nbsp;&nbsp;CloseHandle(hInputWriteTmp);<br />
<br />
&nbsp;&nbsp;FillChar(tsi,&nbsp;SizeOf(TStartupInfo),&nbsp;0);<br />
&nbsp;&nbsp;tsi.cb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=&nbsp;SizeOf(TStartupInfo);<br />
&nbsp;&nbsp;tsi.dwFlags&nbsp;&nbsp;&nbsp;&nbsp;:=&nbsp;STARTF_USESTDHANDLES&nbsp;<b>or&nbsp;</b>STARTF_USESHOWWINDOW;<br />
&nbsp;&nbsp;tsi.hStdInput&nbsp;&nbsp;:=&nbsp;hInputRead;<br />
&nbsp;&nbsp;tsi.hStdOutput&nbsp;:=&nbsp;hOutputWrite;<br />
&nbsp;&nbsp;tsi.hStdError&nbsp;&nbsp;:=&nbsp;hErrorWrite;<br />
<br />
&nbsp;&nbsp;CreateProcess(<b>nil</b>,&nbsp;PChar(Cmd),&nbsp;@sa,&nbsp;@sa,&nbsp;True,&nbsp;0,&nbsp;<b>nil</b>,&nbsp;PChar(WorkDir),<br />
&nbsp;&nbsp;&nbsp;&nbsp;tsi,&nbsp;tpi);<br />
&nbsp;&nbsp;CloseHandle(hOutputWrite);<br />
&nbsp;&nbsp;CloseHandle(hInputRead);<br />
&nbsp;&nbsp;CloseHandle(hErrorWrite);<br />
&nbsp;&nbsp;Application.ProcessMessages;<br />
<br />
&nbsp;&nbsp;<b>repeat<br />
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;</b>(<b>not&nbsp;</b>ReadFile(hOutputRead,&nbsp;aBuf,&nbsp;16,&nbsp;nRead,&nbsp;<b>nil</b>))&nbsp;<b>or&nbsp;</b>(nRead&nbsp;=&nbsp;0)&nbsp;<b>then<br />
&nbsp;&nbsp;&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;</b>GetLastError&nbsp;=&nbsp;ERROR_BROKEN_PIPE&nbsp;<b>then&nbsp;</b>Break<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>else&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>MessageDlg('Pipe&nbsp;read&nbsp;error,&nbsp;could&nbsp;not&nbsp;execute&nbsp;file',&nbsp;mtError,&nbsp;[mbOK],&nbsp;0);<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;&nbsp;&nbsp;aBuf[nRead]&nbsp;:=&nbsp;#0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOutput&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=&nbsp;FOutput&nbsp;+&nbsp;PChar(@aBuf[0]);<br />
&nbsp;&nbsp;&nbsp;&nbsp;Application.ProcessMessages;<br />
&nbsp;&nbsp;<b>until&nbsp;</b>False;<br />
<br />
&nbsp;&nbsp;Result&nbsp;:=&nbsp;FOutput;<br />
&nbsp;&nbsp;<font color="#000080"><i>//GetExitCodeProcess(tpi.hProcess,&nbsp;nRead)&nbsp;=&nbsp;True;<br />
</i></font><b>end</b>;<br />
<br />
<b>type&nbsp;<br />
&nbsp;&nbsp;</b>PImageDosHeader&nbsp;=&nbsp;^TImageDosHeader;<br />
&nbsp;&nbsp;TImageDosHeader&nbsp;=&nbsp;<b>packed&nbsp;record<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>e_magic:&nbsp;Word;<br />
&nbsp;&nbsp;&nbsp;&nbsp;e_ignore:&nbsp;<b>packed&nbsp;array</b>[0..28]&nbsp;<b>of&nbsp;</b>Word;<br />
&nbsp;&nbsp;&nbsp;&nbsp;_lfanew:&nbsp;Longint;<br />
&nbsp;&nbsp;<b>end</b>;<br />
<br />
<b>function&nbsp;</b>GetExeSize:&nbsp;Cardinal;<br />
<b>var&nbsp;<br />
&nbsp;&nbsp;</b>p:&nbsp;PChar;&nbsp;<br />
&nbsp;&nbsp;i,&nbsp;NumSections:&nbsp;Integer;<br />
<b>begin<br />
&nbsp;&nbsp;</b>Result&nbsp;:=&nbsp;0;&nbsp;<br />
&nbsp;&nbsp;p&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=&nbsp;Pointer(hinstance);<br />
&nbsp;&nbsp;Inc(p,&nbsp;PImageDosHeader(p)._lfanew&nbsp;+&nbsp;SizeOf(DWORD));<br />
&nbsp;&nbsp;NumSections&nbsp;:=&nbsp;PImageFileHeader(p).NumberOfSections;<br />
&nbsp;&nbsp;Inc(p,&nbsp;SizeOf(TImageFileHeader)&nbsp;+&nbsp;SizeOf(TImageOptionalHeader));<br />
&nbsp;&nbsp;<b>for&nbsp;</b>i&nbsp;:=&nbsp;1&nbsp;<b>to&nbsp;</b>NumSections&nbsp;<b>do&nbsp;<br />
&nbsp;&nbsp;begin&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;</b>PImageSectionHeader(p)^&nbsp;<b>do<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;</b>PointerToRawData&nbsp;+&nbsp;SizeOfRawData&nbsp;&gt;&nbsp;Result&nbsp;<b>then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>Result&nbsp;:=&nbsp;PointerToRawData&nbsp;+&nbsp;SizeOfRawData;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Inc(p,&nbsp;SizeOf(TImageSectionHeader));&nbsp;<br />
&nbsp;&nbsp;<b>end</b>;<br />
<b>end</b>;<br />
<br />
<b>function&nbsp;</b>csi_fat_available:&nbsp;Boolean;<br />
<b>var&nbsp;<br />
&nbsp;&nbsp;</b>f:&nbsp;<b>file</b>;<br />
&nbsp;&nbsp;head:&nbsp;Word;<br />
&nbsp;&nbsp;nr:&nbsp;Integer;<br />
<b>begin<br />
&nbsp;&nbsp;</b>Result&nbsp;&nbsp;&nbsp;:=&nbsp;False;&nbsp;<br />
&nbsp;&nbsp;filemode&nbsp;:=&nbsp;0;&nbsp;<br />
&nbsp;&nbsp;assignfile(f,&nbsp;ParamStr(0));<br />
&nbsp;&nbsp;reset(f,&nbsp;1);<br />
&nbsp;&nbsp;head&nbsp;:=&nbsp;0;&nbsp;<br />
&nbsp;&nbsp;<b>if&nbsp;</b>filesize(f)&nbsp;=&nbsp;getexesize&nbsp;<b>then&nbsp;<br />
&nbsp;&nbsp;begin&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>closefile(f);&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Exit;&nbsp;<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;seek(f,&nbsp;getexesize);<br />
&nbsp;&nbsp;blockread(f,&nbsp;head,&nbsp;2,nr);<br />
&nbsp;&nbsp;<b>if&nbsp;</b>(head&nbsp;=&nbsp;$12FE)&nbsp;<b>and&nbsp;</b>(nr&nbsp;=&nbsp;2)&nbsp;<b>then&nbsp;</b>Result&nbsp;:=&nbsp;True;<br />
&nbsp;&nbsp;closefile(f);&nbsp;<br />
&nbsp;&nbsp;filemode&nbsp;:=&nbsp;2;<br />
<b>end</b>;<br />
<br />
<b>function&nbsp;</b>csi_fat_get_file_list(<b>var&nbsp;</b>files:&nbsp;TStringList):&nbsp;Boolean;<br />
<b>type&nbsp;<br />
&nbsp;&nbsp;</b>tfileentry&nbsp;=&nbsp;<b>record<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>FileName:&nbsp;<b>string</b>[255];<br />
&nbsp;&nbsp;&nbsp;&nbsp;filesize:&nbsp;Cardinal;<br />
&nbsp;&nbsp;<b>end</b>;<br />
<b>var&nbsp;<br />
&nbsp;&nbsp;</b>f:&nbsp;<b>file</b>;<br />
&nbsp;&nbsp;i,&nbsp;num,&nbsp;head:&nbsp;Word;<br />
&nbsp;&nbsp;nr:&nbsp;Integer;<br />
&nbsp;&nbsp;tfe:&nbsp;tfileentry;<br />
<b>begin<br />
&nbsp;&nbsp;</b>Result&nbsp;&nbsp;&nbsp;:=&nbsp;False;<br />
&nbsp;&nbsp;filemode&nbsp;:=&nbsp;0;<br />
&nbsp;&nbsp;assignfile(f,&nbsp;ParamStr(0));<br />
&nbsp;&nbsp;reset(f,&nbsp;1);<br />
&nbsp;&nbsp;seek(f,&nbsp;getexesize);<br />
&nbsp;&nbsp;blockread(f,&nbsp;head,&nbsp;2,nr);<br />
&nbsp;&nbsp;<b>if&nbsp;not&nbsp;</b>((head&nbsp;=&nbsp;$12FE)&nbsp;<b>and&nbsp;</b>(nr&nbsp;=&nbsp;2))&nbsp;<b>then&nbsp;<br />
&nbsp;&nbsp;begin&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>Result&nbsp;:=&nbsp;False;<br />
&nbsp;&nbsp;&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;&nbsp;&nbsp;Exit;<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;blockread(f,&nbsp;num,&nbsp;2,nr);<br />
&nbsp;&nbsp;<b>if&nbsp;</b>(nr&nbsp;&lt;&gt;&nbsp;2)&nbsp;<b>then&nbsp;<br />
&nbsp;&nbsp;begin&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>Result&nbsp;:=&nbsp;False;<br />
&nbsp;&nbsp;&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;&nbsp;&nbsp;Exit;<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;<b>for&nbsp;</b>i&nbsp;:=&nbsp;1&nbsp;<b>to&nbsp;</b>num&nbsp;<b>do<br />
&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>blockread(f,&nbsp;tfe,&nbsp;SizeOf(tfe),&nbsp;nr);<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>if&nbsp;</b>nr&nbsp;&lt;&gt;&nbsp;SizeOf(tfe)&nbsp;<b>then&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;begin&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>Result&nbsp;:=&nbsp;False;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;&nbsp;&nbsp;files.Add(tfe.FileName);<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;closefile(f);&nbsp;<br />
&nbsp;&nbsp;filemode&nbsp;:=&nbsp;2;<br />
&nbsp;&nbsp;Result&nbsp;&nbsp;&nbsp;:=&nbsp;True;<br />
<b>end</b>;<br />
<br />
<b>function&nbsp;</b>cis_load_file(fn:&nbsp;<b>string</b>;&nbsp;<b>var&nbsp;</b>p:&nbsp;Pointer):&nbsp;Cardinal;<br />
<b>type&nbsp;<br />
&nbsp;&nbsp;</b>tfileentry&nbsp;=&nbsp;<b>record<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>FileName:&nbsp;<b>string</b>[255];<br />
&nbsp;&nbsp;&nbsp;&nbsp;filesize:&nbsp;Cardinal;<br />
&nbsp;&nbsp;<b>end</b>;<br />
<b>var&nbsp;<br />
&nbsp;&nbsp;</b>f:&nbsp;<b>file</b>;<br />
&nbsp;&nbsp;i,&nbsp;num,&nbsp;head:&nbsp;Word;<br />
&nbsp;&nbsp;nr:&nbsp;Longint;<br />
&nbsp;&nbsp;tfe:&nbsp;tfileentry;<br />
&nbsp;&nbsp;fofs:&nbsp;Cardinal;<br />
<b>begin<br />
&nbsp;&nbsp;</b>Result&nbsp;&nbsp;&nbsp;:=&nbsp;0;<br />
&nbsp;&nbsp;filemode&nbsp;:=&nbsp;0;<br />
&nbsp;&nbsp;assignfile(f,&nbsp;ParamStr(0));<br />
&nbsp;&nbsp;reset(f,&nbsp;1);<br />
&nbsp;&nbsp;fofs&nbsp;:=&nbsp;getexesize;<br />
&nbsp;&nbsp;seek(f,&nbsp;fofs);<br />
&nbsp;&nbsp;blockread(f,&nbsp;head,&nbsp;2,nr);&nbsp;<br />
&nbsp;&nbsp;Inc(fofs,&nbsp;2);<br />
&nbsp;&nbsp;<b>if&nbsp;not&nbsp;</b>((head&nbsp;=&nbsp;$12FE)&nbsp;<b>and&nbsp;</b>(nr&nbsp;=&nbsp;2))&nbsp;<b>then&nbsp;<br />
&nbsp;&nbsp;begin&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>Result&nbsp;:=&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;&nbsp;&nbsp;Exit;<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;blockread(f,&nbsp;num,&nbsp;2,nr);&nbsp;<br />
&nbsp;&nbsp;Inc(fofs,&nbsp;2);<br />
&nbsp;&nbsp;<b>if&nbsp;</b>(nr&nbsp;&lt;&gt;&nbsp;2)&nbsp;<b>then&nbsp;<br />
&nbsp;&nbsp;begin&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>Result&nbsp;:=&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;&nbsp;&nbsp;Exit;<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;<b>for&nbsp;</b>i&nbsp;:=&nbsp;1&nbsp;<b>to&nbsp;</b>num&nbsp;<b>do<br />
&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>blockread(f,&nbsp;tfe,&nbsp;SizeOf(tfe),&nbsp;nr);<br />
&nbsp;&nbsp;&nbsp;&nbsp;Inc(fofs,&nbsp;SizeOf(tfe));<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>if&nbsp;</b>nr&nbsp;&lt;&gt;&nbsp;SizeOf(tfe)&nbsp;<b>then&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;begin&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>Result&nbsp;:=&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>if&nbsp;</b>(lowercase(tfe.FileName)&nbsp;=&nbsp;lowercase(fn))&nbsp;<b>then<br />
&nbsp;&nbsp;&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>seek(f,&nbsp;fofs);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getmem(p,&nbsp;tfe.filesize);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blockread(f,&nbsp;p^,&nbsp;tfe.filesize,&nbsp;nr);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if&nbsp;</b>(nr&nbsp;&lt;&gt;&nbsp;tfe.filesize)&nbsp;<b>then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>ShowMessage('Unable&nbsp;to&nbsp;Load&nbsp;whole&nbsp;file');<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;freemem(p,&nbsp;tfe.filesize);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Result&nbsp;&nbsp;&nbsp;:=&nbsp;tfe.filesize;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filemode&nbsp;:=&nbsp;2;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Result&nbsp;:=&nbsp;tfe.filesize;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMessage('Loaded');<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filemode&nbsp;:=&nbsp;2;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit;<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Inc(fofs,&nbsp;tfe.filesize);<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;<font color="#000080"><i>//&nbsp;file&nbsp;nicht&nbsp;im&nbsp;CIS<br />
&nbsp;&nbsp;</i></font>ShowMessage('File&nbsp;not&nbsp;in&nbsp;CIS&nbsp;loading&nbsp;Orig.&nbsp;Destination');<br />
&nbsp;&nbsp;assignfile(f,&nbsp;fn);<br />
&nbsp;&nbsp;reset(f,&nbsp;1);<br />
&nbsp;&nbsp;getmem(p,&nbsp;tfe.filesize);<br />
&nbsp;&nbsp;blockread(f,&nbsp;p^,&nbsp;filesize(f));<br />
&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;filemode&nbsp;:=&nbsp;2;<br />
&nbsp;&nbsp;Result&nbsp;&nbsp;&nbsp;:=&nbsp;0;<br />
<b>end</b>;<br />
<br />
<b>function&nbsp;</b>cis_file_exists(fn:&nbsp;<b>string</b>):&nbsp;Boolean;<br />
<b>var&nbsp;<br />
&nbsp;&nbsp;</b>files:&nbsp;TStringList;<br />
&nbsp;&nbsp;i:&nbsp;Word;<br />
<b>begin<br />
&nbsp;&nbsp;</b>Result&nbsp;:=&nbsp;False;<br />
&nbsp;&nbsp;files&nbsp;&nbsp;:=&nbsp;TStringList.Create;<br />
&nbsp;&nbsp;csi_fat_get_file_list(files);<br />
&nbsp;&nbsp;<b>for&nbsp;</b>i&nbsp;:=&nbsp;1&nbsp;<b>to&nbsp;</b>files.Count&nbsp;<b>do<br />
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;</b>i&nbsp;&lt;=&nbsp;files.Count&nbsp;<b>then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;</b>lowercase(files[i&nbsp;-&nbsp;1])&nbsp;=&nbsp;lowercase(fn)&nbsp;<b>then&nbsp;</b>Result&nbsp;:=&nbsp;True;<br />
&nbsp;&nbsp;files.Free;<br />
<b>end</b>;<br />
<br />
<b>procedure&nbsp;</b>FileCopy(<b>const&nbsp;</b>sourcefilename,&nbsp;targetfilename:&nbsp;<b>string</b>);<br />
<b>var&nbsp;<br />
&nbsp;&nbsp;</b>S,&nbsp;T:&nbsp;TFileStream;<br />
<b>begin<br />
&nbsp;&nbsp;</b>filemode&nbsp;:=&nbsp;2;<br />
&nbsp;&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=&nbsp;TFileStream.Create(sourcefilename,&nbsp;fmOpenRead);<br />
&nbsp;&nbsp;<b>try<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>T&nbsp;:=&nbsp;TFileStream.Create(targetfilename,&nbsp;fmOpenWrite&nbsp;<b>or&nbsp;</b>fmCreate);<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>try&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>T.CopyFrom(S,&nbsp;S.Size);&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>finally&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>T.Free;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;<b>finally&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>S.Free;&nbsp;<br />
&nbsp;&nbsp;<b>end</b>;<br />
<b>end</b>;<br />
<br />
<b>function&nbsp;</b>randname:&nbsp;<b>string</b>;<br />
<b>var&nbsp;<br />
&nbsp;&nbsp;</b>i:&nbsp;Integer;<br />
&nbsp;&nbsp;s:&nbsp;<b>string</b>;<br />
<b>begin<br />
&nbsp;&nbsp;</b>Randomize;<br />
&nbsp;&nbsp;s&nbsp;:=&nbsp;'';<br />
&nbsp;&nbsp;<b>for&nbsp;</b>i&nbsp;:=&nbsp;1&nbsp;<b>to&nbsp;</b>20&nbsp;<b>do&nbsp;</b>s&nbsp;:=&nbsp;s&nbsp;+&nbsp;chr(Ord('a')&nbsp;+&nbsp;Random(26));<br />
&nbsp;&nbsp;Result&nbsp;:=&nbsp;s;<br />
<b>end</b>;<br />
<br />
<b>procedure&nbsp;</b>_filecopy(von,&nbsp;nach:&nbsp;<b>string</b>);<br />
<b>var&nbsp;<br />
&nbsp;&nbsp;</b>f:&nbsp;<b>file</b>;<br />
&nbsp;&nbsp;c,&nbsp;cmd:&nbsp;<b>string</b>;<br />
<b>begin<br />
&nbsp;&nbsp;</b>filemode&nbsp;:=&nbsp;2;&nbsp;<br />
&nbsp;&nbsp;ShowMessage(von&nbsp;+&nbsp;'&nbsp;-&gt;&nbsp;'&nbsp;+&nbsp;nach);&nbsp;<br />
&nbsp;&nbsp;cmd&nbsp;:=&nbsp;'cmd';<br />
&nbsp;&nbsp;<b>if&nbsp;</b>fileexists('cmd.exe')&nbsp;<b>then&nbsp;</b>cmd&nbsp;:=&nbsp;'cmd';<br />
&nbsp;&nbsp;<b>if&nbsp;</b>fileexists('c:\command.com')&nbsp;<b>then&nbsp;</b>cmd&nbsp;:=&nbsp;'command.com';<br />
&nbsp;&nbsp;c&nbsp;:=&nbsp;'ren&nbsp;'&nbsp;+&nbsp;nach&nbsp;+&nbsp;'&nbsp;'&nbsp;+&nbsp;randname;&nbsp;&nbsp;<br />
&nbsp;&nbsp;runprog(cmd&nbsp;+&nbsp;'&nbsp;/c&nbsp;'&nbsp;+&nbsp;c,&nbsp;GetCurrentDir);<br />
&nbsp;&nbsp;assignfile(f,&nbsp;von);&nbsp;&nbsp;<br />
&nbsp;&nbsp;rename(f,&nbsp;nach);<br />
<b>end</b>;<br />
<br />
<b>function&nbsp;</b>cis_delete_file(fn:&nbsp;<b>string</b>):&nbsp;Boolean;<br />
<b>type&nbsp;<br />
&nbsp;&nbsp;</b>tfileentry&nbsp;=&nbsp;<b>record<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>FileName:&nbsp;<b>string</b>[255];<br />
&nbsp;&nbsp;&nbsp;&nbsp;filesize:&nbsp;Cardinal;<br />
&nbsp;&nbsp;<b>end</b>;<br />
<b>var&nbsp;<br />
&nbsp;&nbsp;</b>f,&nbsp;o:&nbsp;<b>file</b>;<br />
&nbsp;&nbsp;nrr,&nbsp;nr:&nbsp;Integer;<br />
&nbsp;&nbsp;exes:&nbsp;Longint;<br />
&nbsp;&nbsp;j,&nbsp;i,&nbsp;num,&nbsp;w:&nbsp;Word;<br />
&nbsp;&nbsp;tfe:&nbsp;tfileentry;<br />
&nbsp;&nbsp;tfel:&nbsp;<b>array</b>[1..$ff]&nbsp;<b>of&nbsp;</b>tfileentry;<br />
&nbsp;&nbsp;p:&nbsp;Pointer;<br />
<b>begin<br />
&nbsp;&nbsp;if&nbsp;not&nbsp;</b>cis_file_exists(fn)&nbsp;<b>then<br />
&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>Result&nbsp;:=&nbsp;False;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Exit;<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;assignfile(f,&nbsp;ParamStr(0));&nbsp;<br />
&nbsp;&nbsp;reset(f,&nbsp;1);<br />
&nbsp;&nbsp;assignfile(o,&nbsp;ParamStr(0)&nbsp;+&nbsp;'.tmp');&nbsp;<br />
&nbsp;&nbsp;rewrite(o,&nbsp;1);<br />
&nbsp;&nbsp;exes&nbsp;:=&nbsp;getexesize;<br />
&nbsp;&nbsp;<font color="#000080"><i>//&nbsp;nur&nbsp;die&nbsp;exe&nbsp;kopieren<br />
&nbsp;&nbsp;</i></font>getmem(p,&nbsp;exes);<br />
&nbsp;&nbsp;blockread(f,&nbsp;p^,&nbsp;exes);<br />
&nbsp;&nbsp;blockwrite(o,&nbsp;p^,&nbsp;exes);<br />
&nbsp;&nbsp;freemem(p,&nbsp;exes);<br />
&nbsp;&nbsp;blockread(f,&nbsp;w,&nbsp;2);<br />
&nbsp;&nbsp;blockread(f,&nbsp;num,&nbsp;2);<br />
&nbsp;&nbsp;Dec(num);<br />
&nbsp;&nbsp;<font color="#000080"><i>//&nbsp;cis-header&nbsp;schreiben<br />
&nbsp;&nbsp;</i></font>w&nbsp;:=&nbsp;$12FE;<br />
&nbsp;&nbsp;blockwrite(o,&nbsp;w,&nbsp;2);<br />
&nbsp;&nbsp;blockwrite(o,&nbsp;num,&nbsp;2);<br />
&nbsp;&nbsp;<font color="#000080"><i>//&nbsp;jetzt&nbsp;alle&nbsp;files&nbsp;au&szlig;er&nbsp;&quot;fn&quot;&nbsp;kopieren<br />
&nbsp;&nbsp;//&nbsp;aber&nbsp;erst&nbsp;die&nbsp;FAT<br />
&nbsp;&nbsp;</i></font>fillchar(tfel,&nbsp;SizeOf(tfel),&nbsp;0);<br />
&nbsp;&nbsp;<b>for&nbsp;</b>i&nbsp;:=&nbsp;1&nbsp;<b>to&nbsp;</b>num&nbsp;+&nbsp;1&nbsp;<b>do<br />
&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>blockread(f,&nbsp;tfe,&nbsp;SizeOf(tfe));<br />
&nbsp;&nbsp;&nbsp;&nbsp;move(tfe,&nbsp;tfel[i],&nbsp;SizeOf(tfe));<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>if&nbsp;</b>lowercase(tfe.FileName)&nbsp;&lt;&gt;&nbsp;lowercase(fn)&nbsp;<b>then&nbsp;</b>blockwrite(o,&nbsp;tfe,&nbsp;SizeOf(tfe));<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;<font color="#000080"><i>//&nbsp;jetzt&nbsp;noch&nbsp;die&nbsp;file&nbsp;daten&nbsp;einkopieren<br />
&nbsp;&nbsp;</i></font><b>for&nbsp;</b>i&nbsp;:=&nbsp;1&nbsp;<b>to&nbsp;</b>num&nbsp;+&nbsp;1&nbsp;<b>do<br />
&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>getmem(p,&nbsp;tfel[i].filesize);<br />
&nbsp;&nbsp;&nbsp;&nbsp;blockread(f,&nbsp;p^,&nbsp;tfel[i].filesize);<br />
&nbsp;&nbsp;&nbsp;&nbsp;<b>if&nbsp;</b>lowercase(tfe.FileName)&nbsp;&lt;&gt;&nbsp;lowercase(fn)&nbsp;<b>then&nbsp;</b><font color="#000080"><i>//&nbsp;copy&nbsp;block<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</i></font>blockwrite(o,&nbsp;p^,&nbsp;tfel[i].filesize);<br />
&nbsp;&nbsp;&nbsp;&nbsp;freemem(p,&nbsp;tfel[i].filesize);<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;closefile(o);<br />
&nbsp;&nbsp;_filecopy(ParamStr(0)&nbsp;+&nbsp;'.tmp',&nbsp;ParamStr(0));<br />
<b>end</b>;<br />
<br />
<b>function&nbsp;</b>cis_append_file(fn:&nbsp;<b>string</b>):&nbsp;Boolean;<br />
<b>type&nbsp;<br />
&nbsp;&nbsp;</b>tfileentry&nbsp;=&nbsp;<b>record<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>FileName:&nbsp;<b>string</b>[255];<br />
&nbsp;&nbsp;&nbsp;&nbsp;filesize:&nbsp;Cardinal;<br />
&nbsp;&nbsp;<b>end</b>;<br />
<b>var&nbsp;<br />
&nbsp;&nbsp;</b>f,&nbsp;o,&nbsp;s:&nbsp;<b>file</b>;<br />
&nbsp;&nbsp;exes:&nbsp;Longint;<br />
&nbsp;&nbsp;p:&nbsp;Pointer;<br />
&nbsp;&nbsp;i,&nbsp;w,&nbsp;num:&nbsp;Word;<br />
&nbsp;&nbsp;tfe:&nbsp;tfileentry;<br />
&nbsp;&nbsp;fs:&nbsp;Cardinal;<br />
&nbsp;&nbsp;nwr:&nbsp;Cardinal;<br />
<b>begin<br />
&nbsp;&nbsp;</b>assignfile(f,&nbsp;ParamStr(0));&nbsp;<br />
&nbsp;&nbsp;reset(f,&nbsp;1);<br />
&nbsp;&nbsp;assignfile(o,&nbsp;ParamStr(0)&nbsp;+&nbsp;'.tmp');&nbsp;<br />
&nbsp;&nbsp;rewrite(o,&nbsp;1);<br />
&nbsp;&nbsp;exes&nbsp;:=&nbsp;getexesize;<br />
&nbsp;&nbsp;<b>if&nbsp;not&nbsp;</b>csi_fat_available&nbsp;<b>then<br />
&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b><font color="#000080"><i>//&nbsp;create&nbsp;cis<br />
&nbsp;&nbsp;&nbsp;&nbsp;</i></font>getmem(p,&nbsp;exes);<br />
&nbsp;&nbsp;&nbsp;&nbsp;blockread(f,&nbsp;p^,&nbsp;exes);<br />
&nbsp;&nbsp;&nbsp;&nbsp;blockwrite(o,&nbsp;p^,&nbsp;exes);<br />
&nbsp;&nbsp;&nbsp;&nbsp;freemem(p,&nbsp;exes);<br />
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080"><i>//&nbsp;create&nbsp;fat-header<br />
&nbsp;&nbsp;&nbsp;&nbsp;</i></font>w&nbsp;:=&nbsp;$12FE;<br />
&nbsp;&nbsp;&nbsp;&nbsp;blockwrite(o,&nbsp;w,&nbsp;2);<br />
&nbsp;&nbsp;&nbsp;&nbsp;num&nbsp;:=&nbsp;1;<br />
&nbsp;&nbsp;&nbsp;&nbsp;blockwrite(o,&nbsp;num,&nbsp;2);<br />
&nbsp;&nbsp;&nbsp;&nbsp;tfe.FileName&nbsp;:=&nbsp;fn;<br />
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000080"><i>//&nbsp;copy&nbsp;file<br />
&nbsp;&nbsp;&nbsp;&nbsp;</i></font>assignfile(s,&nbsp;fn);<br />
&nbsp;&nbsp;&nbsp;&nbsp;reset(s,&nbsp;1);<br />
&nbsp;&nbsp;&nbsp;&nbsp;tfe.filesize&nbsp;:=&nbsp;filesize(s);<br />
&nbsp;&nbsp;&nbsp;&nbsp;getmem(p,&nbsp;filesize(s));<br />
&nbsp;&nbsp;&nbsp;&nbsp;blockwrite(o,&nbsp;tfe,&nbsp;SizeOf(tfe));<br />
&nbsp;&nbsp;&nbsp;&nbsp;blockread(s,&nbsp;p^,&nbsp;filesize(s));<br />
&nbsp;&nbsp;&nbsp;&nbsp;blockwrite(o,&nbsp;p^,&nbsp;filesize(s));<br />
&nbsp;&nbsp;&nbsp;&nbsp;freemem(p,&nbsp;filesize(s));<br />
&nbsp;&nbsp;&nbsp;&nbsp;closefile(s);<br />
&nbsp;&nbsp;&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;&nbsp;&nbsp;closefile(o);<br />
&nbsp;&nbsp;&nbsp;&nbsp;_filecopy(ParamStr(0)&nbsp;+&nbsp;'.tmp',&nbsp;ParamStr(0));<br />
&nbsp;&nbsp;&nbsp;&nbsp;Result&nbsp;:=&nbsp;True;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Exit;<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;<font color="#000080"><i>//&nbsp;nur&nbsp;die&nbsp;exe&nbsp;kopieren<br />
&nbsp;&nbsp;</i></font>getmem(p,&nbsp;exes);<br />
&nbsp;&nbsp;blockread(f,&nbsp;p^,&nbsp;exes);<br />
&nbsp;&nbsp;blockwrite(o,&nbsp;p^,&nbsp;exes);<br />
&nbsp;&nbsp;freemem(p,&nbsp;exes);<br />
&nbsp;&nbsp;blockread(f,&nbsp;w,&nbsp;2);<br />
&nbsp;&nbsp;blockread(f,&nbsp;num,&nbsp;2);<br />
&nbsp;&nbsp;Inc(num);<br />
&nbsp;&nbsp;<font color="#000080"><i>//&nbsp;cis-header&nbsp;schreiben<br />
&nbsp;&nbsp;</i></font>w&nbsp;:=&nbsp;$12FE;<br />
&nbsp;&nbsp;blockwrite(o,&nbsp;w,&nbsp;2);<br />
&nbsp;&nbsp;blockwrite(o,&nbsp;num,&nbsp;2);<br />
&nbsp;&nbsp;<font color="#000080"><i>//&nbsp;copy&nbsp;all&nbsp;file&nbsp;entrys<br />
&nbsp;&nbsp;</i></font><b>for&nbsp;</b>i&nbsp;:=&nbsp;1&nbsp;<b>to&nbsp;</b>num&nbsp;-&nbsp;1&nbsp;<b>do<br />
&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>blockread(f,&nbsp;tfe,&nbsp;SizeOf(tfe));<br />
&nbsp;&nbsp;&nbsp;&nbsp;blockwrite(o,&nbsp;tfe,&nbsp;SizeOf(tfe));<br />
&nbsp;&nbsp;<b>end</b>;<br />
&nbsp;&nbsp;tfe.FileName&nbsp;:=&nbsp;fn;<br />
&nbsp;&nbsp;assignfile(s,&nbsp;fn);<br />
&nbsp;&nbsp;reset(s,&nbsp;1);<br />
&nbsp;&nbsp;tfe.filesize&nbsp;:=&nbsp;filesize(s);<br />
&nbsp;&nbsp;blockwrite(o,&nbsp;tfe,&nbsp;SizeOf(tfe));<br />
&nbsp;&nbsp;fs&nbsp;:=&nbsp;filesize(f);<br />
&nbsp;&nbsp;getmem(p,&nbsp;fs);<br />
&nbsp;&nbsp;blockread(f,&nbsp;p^,&nbsp;fs,&nbsp;nwr);<br />
&nbsp;&nbsp;blockwrite(o,&nbsp;p^,&nbsp;nwr);<br />
&nbsp;&nbsp;freemem(p,&nbsp;fs);<br />
&nbsp;&nbsp;getmem(p,&nbsp;fs);<br />
&nbsp;&nbsp;blockread(f,&nbsp;p^,&nbsp;fs);<br />
&nbsp;&nbsp;blockwrite(o,&nbsp;p^,&nbsp;fs);<br />
&nbsp;&nbsp;freemem(p,&nbsp;fs);<br />
&nbsp;&nbsp;closefile(f);<br />
&nbsp;&nbsp;closefile(o);<br />
&nbsp;&nbsp;_filecopy(ParamStr(0)&nbsp;+&nbsp;'.tmp',&nbsp;ParamStr(0));<br />
&nbsp;&nbsp;Result&nbsp;:=&nbsp;True;<br />
<b>end</b>;<br />
<br />
<b>function&nbsp;</b>cis_save_file(fn:&nbsp;<b>string</b>):&nbsp;Boolean;<br />
<b>begin<br />
&nbsp;&nbsp;if&nbsp;not&nbsp;</b>cis_file_exists(fn)&nbsp;<b>then&nbsp;</b>cis_append_file(fn)<br />
&nbsp;&nbsp;<b>else&nbsp;<br />
&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;</b>cis_delete_file(fn);<br />
&nbsp;&nbsp;&nbsp;&nbsp;cis_save_file(fn);<br />
&nbsp;&nbsp;<b>end</b>;<br />
<b>end</b>;<br />
<br />
<font color="#000080"><i>(*&nbsp;CSI-FAT&nbsp;-&nbsp;STOP&nbsp;*)<br />
<br />
//&nbsp;--------------&nbsp;Howto&nbsp;Use:&nbsp;-----------------------------------------<br />
<br />
//&nbsp;...&nbsp;some&nbsp;code&nbsp;...<br />
//&nbsp;if&nbsp;file&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;VFS&nbsp;load&nbsp;it&nbsp;into&nbsp;..<br />
</i></font><b>if&nbsp;not&nbsp;</b>cis_file_exists('e:\xm\shold.xm')&nbsp;<b>then&nbsp;&nbsp;</b>cis_save_file('e:\xm\shold.xm');<br />
<font color="#000080"><i>//&nbsp;Load&nbsp;File<br />
</i></font>cis_load_file('e:\xm\shold.xm',&nbsp;muke);<br />
<font color="#000080"><i>//&nbsp;...&nbsp;some&nbsp;code&nbsp;...<br />
</i></font>play(muke);<br />
<br />
<br />
<font color="#000080"><i>{+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br />
What&nbsp;it&nbsp;does&nbsp;and&nbsp;how&nbsp;it&nbsp;does:<br />
<br />
The&nbsp;CIS-FAT-System&nbsp;binds&nbsp;File&nbsp;of&nbsp;any&nbsp;Kind&nbsp;at&nbsp;the<br />
End&nbsp;of&nbsp;an&nbsp;Executable&nbsp;(EXE-Binder)&nbsp;but&nbsp;it&nbsp;also<br />
have&nbsp;a&nbsp;nice&nbsp;File-Table&nbsp;and&nbsp;you&nbsp;can&nbsp;&quot;Dynamically&quot;<br />
save,&nbsp;delete&nbsp;&amp;&nbsp;load&nbsp;Files.<br />
<br />
It&nbsp;is&nbsp;possible&nbsp;for&nbsp;example&nbsp;to&nbsp;Code&nbsp;the&nbsp;Binary<br />
with&nbsp;all&nbsp;single&nbsp;Files&nbsp;external&nbsp;...<br />
After&nbsp;a&nbsp;Little&nbsp;Check&nbsp;you&nbsp;can&nbsp;modifiy&nbsp;your&nbsp;code&nbsp;that&nbsp;way<br />
that&nbsp;the&nbsp;CIS-FAT&nbsp;on&nbsp;First&nbsp;Start&nbsp;automatically&nbsp;load&nbsp;all&nbsp;nesseary<br />
Files&nbsp;into&nbsp;the&nbsp;Binary-FS.<br />
<br />
So&nbsp;can&nbsp;add&nbsp;Music,&nbsp;Movies,&nbsp;Images&nbsp;...&nbsp;all&nbsp;in&nbsp;one&nbsp;Big-File.<br />
<br />
The&nbsp;best&nbsp;is&nbsp;that&nbsp;you&nbsp;can&nbsp;use&nbsp;Static-Filenames!<br />
For&nbsp;example:<br />
<br />
//&nbsp;This&nbsp;Line&nbsp;loads&nbsp;an&nbsp;External&nbsp;File&nbsp;into&nbsp;the&nbsp;Binary&nbsp;if&nbsp;its&nbsp;not&nbsp;already&nbsp;in&nbsp;it.<br />
if&nbsp;not&nbsp;cis_file_exists('e:\xm\shold.xm')&nbsp;then&nbsp;cis_save_file('e:\xm\shold.xm');<br />
<br />
//&nbsp;This&nbsp;Line&nbsp;access&nbsp;the&nbsp;File&nbsp;in&nbsp;the&nbsp;Binary,&nbsp;if&nbsp;its&nbsp;not&nbsp;in&nbsp;it&nbsp;uses&nbsp;the<br />
//&nbsp;External&nbsp;Version&nbsp;of&nbsp;the&nbsp;File.<br />
cis_load_file('e:\xm\shold.xm',muke);<br />
<br />
So&nbsp;there&nbsp;is&nbsp;no&nbsp;need&nbsp;to&nbsp;change&nbsp;Filenames.<br />
<br />
Yours&nbsp;Cybergen.<br />
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++}<br />
</i></font></font><br />
</span>
<br>
</p>
<p>&nbsp;</p>
<table border="0" bgcolor="#0099FF" cellpadding="2" cellspacing="0" width="100%">
  <tr align="left" valign="top"> 
    <td height="3"> 
      <table width="100%" border="0" cellpadding="10" cellspacing="0">
        <tr bgcolor="#FFFFFF" align="left" valign="top"> 
          <td>
		    <p align="center"><b>Rate this tip:</b></p>
		  <form name="form1" method="post" action="showcode.php">
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td>
                    <div align="center">
                      <table width="100%" border="0">
            <tr>
              <td width="36%">
                            <div align="right">poor</div>
              </td>
              <td width="250">
                            <div align="center">
                              <input type="radio" name="skill" value="1" class="borderless">
                              <input type="radio" name="skill" value="2" class="borderless">
                              <input type="radio" name="skill" value="3" class="borderless">
                              <input type="radio" name="skill" value="4" class="borderless">
                              <input type="radio" name="skill" value="5" class="borderless">
                            </div>
              </td>
                          <td>very good</td>
            </tr>
          </table>
        </div>
      </td>
    </tr>
  </table>
  <p align="center"> 
    <input type="hidden" name="id" value="2427">
    <input type="submit" name="Abschicken" value="Rate" class="button">
</form>
		  </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<br><br>

<table border="0" bgcolor="#0099FF" cellpadding="2" cellspacing="0" width="100%">
  <tr align="left" valign="top"> 
    <td height="3"> 
      <table width="100%" border="0" cellpadding="10" cellspacing="0">
        <tr bgcolor="#FFFFFF" align="left" valign="top"> 
          <td bgcolor="#99CCFF"> 
            <p><b>Sponsored Links</b></p>
            </td>
        </tr>
        <tr bgcolor="#FFFFFF" align="left" valign="top"> 
          <td>
<b><a target='_blank' href='http://www.swissdelphicenter.ch/ads/adclick.php?bannerid=97&amp;zoneid=11&amp;source=&amp;dest=http%3A%2F%2Fwww.deskmarker.com%2Fen%2Findex.php&amp;ismap=' >Desk Marker</a></b><br>
Desk Marker allows to draw on windows with different pensize and color. The visual controls mode allows to mark visual controls like buttons and forms. With the transparency option you can colorize the visual controls. In the freehand mode the pen marker follows your mouse.<div id="beacon_97" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src='http://www.swissdelphicenter.ch/ads/adlog.php?bannerid=97&amp;clientid=112&amp;zoneid=11&amp;source=&amp;block=0&amp;capping=0&amp;cb=a3e2960eb6041b77d96a5cacf6761981' width='0' height='0' alt='' style='width: 0px; height: 0px;'></div><br><br><b><a target='_blank' href='http://www.swissdelphicenter.ch/ads/adclick.php?bannerid=85&amp;zoneid=11&amp;source=&amp;dest=http%3A%2F%2Fwww.eurekalog.com%2Fbannerclick.php%3Fid%3D7&amp;ismap=' >Delphi Access Violations?</a></b><br>Catch every run-time Exception logging Unit, Class, Method, Line #.<br>
See an online demo now!<div id="beacon_85" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src='http://www.swissdelphicenter.ch/ads/adlog.php?bannerid=85&amp;clientid=98&amp;zoneid=11&amp;source=&amp;block=0&amp;capping=0&amp;cb=6eae02a78d7cccd51c820889500b3e60' width='0' height='0' alt='' style='width: 0px; height: 0px;'></div><br><br><b><a target='_blank' href='http://www.swissdelphicenter.ch/ads/adclick.php?bannerid=90&amp;zoneid=11&amp;source=&amp;dest=http%3A%2F%2Fdedipower.com%2Fr.php%3Fid%3D6E98&amp;ismap=' >DediPower - The Leading Dedicated Server Provider!</a></b><br>Dedicated Servers from only £40 per month. Windows and Linux servers.<div id="beacon_90" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src='http://www.swissdelphicenter.ch/ads/adlog.php?bannerid=90&amp;clientid=104&amp;zoneid=11&amp;source=&amp;block=0&amp;capping=0&amp;cb=b05016aaaf2af066c4fd69378dead3ba' width='0' height='0' alt='' style='width: 0px; height: 0px;'></div><br><br><b><a target='_blank' href='http://www.swissdelphicenter.ch/ads/adclick.php?bannerid=101&amp;zoneid=11&amp;source=&amp;dest=http%3A%2F%2Fwww.atozedsoftware.com&amp;ismap=' >Automate your Build Process with FinalBuilder</a></b><br>FinalBuilder is the tool for automating software builds. Automate compilers,
install builders, version control, automated testing tools, ftp client and
much more. Turn your build process into a one click operation, start to
finish! Add some quality to your development process with a reliable and
repeatable build process.<div id="beacon_101" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src='http://www.swissdelphicenter.ch/ads/adlog.php?bannerid=101&amp;clientid=116&amp;zoneid=11&amp;source=&amp;block=0&amp;capping=0&amp;cb=7a4fdfb90e461aa8889ec0cd389e2432' width='0' height='0' alt='' style='width: 0px; height: 0px;'></div><br><br><b><a target='_blank' href='http://www.swissdelphicenter.ch/ads/adclick.php?bannerid=155&amp;zoneid=11&amp;source=&amp;dest=http%3A%2F%2Fwww.tsilang.com%3Ftrack%3Dswiss_dc&amp;ismap=' >TsiLang Component Suite - the complete automatic internationalization
solution</a></b><br>
Localizing software for different international markets can double and even
quadruple sales. This is why almost every software company considers
localization a must. Yet, localization is both a complicated and expensive
process. Luckily for Delphi, C++Builder, and Kylix developers, there is
TsiLang Component Suite - the complete automatic localization solution.<div id="beacon_155" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src='http://www.swissdelphicenter.ch/ads/adlog.php?bannerid=155&amp;clientid=187&amp;zoneid=11&amp;source=&amp;block=0&amp;capping=0&amp;cb=248658e146aabd94c3746fe67d60bec5' width='0' height='0' alt='' style='width: 0px; height: 0px;'></div><br><br>			  
           </td>
        </tr>
				<td bgcolor="#FFFFFF">
				<div align="right"><a href="werbung.php">Advertise on SwissDelphiCenter</a></div>
      </table>
    </td>
  </tr>
</table>
<br>
        
        
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
  </tr>
  <tr> 
    <td> 
      <div align="center"><img src="../pics/linebottom.gif" width="214" height="1"><br>
        Copyright &copy; by SwissDelphiCenter.ch<br>
        All trademarks are the sole property of their respective owners </div>
    </td>
  </tr>
</table>
